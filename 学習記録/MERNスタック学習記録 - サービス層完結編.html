<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MERNスタック学習記録 - サービス層完結編</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.8;
            color: #212529;
            max-width: 960px;
            margin: 40px auto;
            padding: 0 20px;
            background-color: #f8f9fa;
        }

        h1,
        h2,
        h3 {
            color: #005f73;
            border-bottom: 2px solid #0a9396;
            padding-bottom: 10px;
            margin-top: 40px;
        }

        h1 {
            text-align: center;
            border-bottom-width: 4px;
            font-size: 2.5em;
            color: #001219;
        }

        h2 {
            font-size: 1.8em;
        }

        code {
            background-color: #e9ecef;
            padding: 3px 7px;
            border-radius: 5px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
            font-size: 0.9em;
        }

        pre {
            background-color: #212529;
            color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .container {
            background-color: #fff;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        strong {
            color: #ae2012;
        }

        .highlight {
            background-color: #e9f5db;
            border-left: 5px solid #7cb518;
            padding: 20px;
            margin: 25px 0;
        }

        .architecture-diagram {
            background: #f1f3f5;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            font-family: monospace;
            font-size: 1.1em;
            line-height: 1.5;
        }
    </style>
</head>

<body>

    <h1>MERNスタック学習記録 - サービス層完結編</h1>

    <div class="container">
        <h2>バックエンドアーキテクチャの完成</h2>
        <p>
            コントローラー層、リポジトリパターンの導入に続き、ついに<strong>「サービス層」</strong>の導入を完了しました。<br>
            これにより、私たちのバックエンドは、現代的なソフトウェア開発におけるベストプラクティスである、責務が明確に分離された4層アーキテクチャへと進化を遂げました。
        </p>
    </div>

    <div class="container">
        <h2>最終的なアーキテクチャ</h2>
        <p>
            クライアントからのリクエストは、各層がそれぞれの専門的な役割を果たすことで処理されます。
        </p>
        <div class="architecture-diagram">
            [ Client (ブラウザ) ]<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br>
            (HTTPリクエスト)<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br>
            [ ルーティング層 ] <span style="color: #6c757d;">(交通整理)</span><br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br>
            [ コントローラー層 ] <span style="color: #6c757d;">(HTTPの専門家)</span><br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br>
            [ <strong>サービス層</strong> ] <span style="color: #ae2012;"><strong>(ビジネスルールの専門家)</strong></span><br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br>
            [ リポジトリ層 ] <span style="color: #6c757d;">(データベースの専門家)</span><br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br>
            [ データベース ]
        </div>
    </div>

    <div class="container">
        <h2>サービス層導入のメリット</h2>
        <p>
            サービス層を導入したことで、<code>users.controllers.js</code>はビジネスロジックから完全に解放され、純粋な「HTTPの専門家」になりました。
        </p>

        <div class="highlight">
            <h4>💡 Before (コントローラー)</h4>
            <pre><code>// ビジネスロジックとHTTP処理が混在
static async someAction(req, res) {
  // パスワードのハッシュ化など...
  const user = await User.findById(...);
  res.json(user);
}</code></pre>

            <h4>✨ After (コントローラー)</h4>
            <pre><code>// HTTP処理に専念し、ビジネスロジックはサービスに委譲
static async someAction(req, res) {
  try {
    const result = await userService.someAction(req.body);
    res.status(200).json(result);
  } catch (error) {
    res.status(error.statusCode || 500).json({ message: error.message });
  }
}</code></pre>
        </div>

        <p>
            この分離により、以下の絶大なメリットがもたらされました。
        </p>
        <ul>
            <li><strong>究極の関心事の分離:</strong> 各層が自身の役割にのみ責任を持つ、極めてクリーンなコードベースが実現しました。</li>
            <li><strong>テスト容易性の最大化:</strong> ビジネスロジックの塊であるサービス層は、HTTPやデータベースから完全に独立しているため、純粋なユニットテストが非常に容易になりました。</li>
            <li><strong>再利用性の向上:</strong> 例えば、将来的にWeb
                APIだけでなく、コマンドラインツールや別のサービスからも同じビジネスロジックを呼び出したい場合、サービス層をそのまま再利用できます。</li>
        </ul>
    </div>

    <div class="container">
        <h2>次のステップへ</h2>
        <p>
            バックエンドが世界クラスの堅牢なアーキテクチャを手に入れた今、次なる挑戦は<strong>フロントエンドの近代化</strong>です。<br>
            現在のコンポーネントは、UIの表示ロジックと状態管理・API通信ロジックが混在しています。これを、Reactの<strong>カスタムフック</strong>を用いて分離することで、フロントエンドのコード品質をバックエンドと同等のレベルまで引き上げていきます。
        </p>
        <p>
            このプロジェクトは、フルスタック開発におけるリファクタリングの素晴らしいケーススタディとなりました。次のステップも楽しみです！
        </p>
    </div>

</body>

</html>